<!DOCTYPE html>
<html>
<head>
    <title>API Specification - E-Commerce Marketplace</title>
    <meta charset="UTF-8">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 4px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            border-bottom: 2px solid #95a5a6;
            padding-bottom: 8px;
            margin-top: 50px;
        }
        h3 {
            color: #555;
            margin-top: 30px;
            font-size: 1.3em;
        }
        h4 {
            color: #666;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        .endpoint-container {
            background-color: white;
            border-radius: 8px;
            padding: 25px;
            margin: 30px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .endpoint-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }
        .method {
            font-weight: bold;
            font-family: 'Courier New', monospace;
            padding: 6px 12px;
            border-radius: 4px;
            display: inline-block;
            min-width: 70px;
            text-align: center;
            font-size: 0.9em;
        }
        .method-get { background-color: #61affe; color: white; }
        .method-post { background-color: #49cc90; color: white; }
        .method-put { background-color: #fca130; color: white; }
        .method-patch { background-color: #50e3c2; color: white; }
        .method-delete { background-color: #f93e3e; color: white; }
        .path {
            font-family: 'Courier New', monospace;
            color: #2c3e50;
            font-weight: 600;
            font-size: 1.1em;
        }
        .section {
            margin: 20px 0;
        }
        .section-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.05em;
        }
        pre {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.5;
        }
        .behavior-steps {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
        }
        .behavior-steps ol {
            margin: 10px 0;
            padding-left: 25px;
        }
        .behavior-steps li {
            margin: 8px 0;
        }
        .status-code {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #e74c3c;
        }
        .note {
            background-color: #e7f3fe;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
        }
        .field-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        .field-table th {
            background-color: #f1f3f5;
            padding: 10px;
            text-align: left;
            border: 1px solid #dee2e6;
            font-weight: 600;
        }
        .field-table td {
            padding: 10px;
            border: 1px solid #dee2e6;
            vertical-align: top;
        }
        .field-table code {
            background-color: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
        }
        .required {
            color: #e74c3c;
            font-weight: bold;
        }
        .optional {
            color: #6c757d;
            font-style: italic;
        }
        code {
            background-color: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .stat-card {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        .stat-number {
            font-size: 36px;
            font-weight: bold;
            color: #3498db;
        }
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>

<h1>API Specification - E-Commerce Marketplace</h1>

<div class="note">
    <strong>Document Purpose:</strong> Comprehensive REST API specification with request models, response models, and behavioral details.
    <br><br>
    <strong>Design Principles:</strong>
    <ul>
        <li>✓ RESTful architecture with proper HTTP methods</li>
        <li>✓ Consistent pagination across all list endpoints</li>
        <li>✓ Unified error handling with standard error codes</li>
        <li>✓ PATCH for partial updates and state management</li>
    </ul>
</div>

<div class="summary-stats">
    <div class="stat-card">
        <div class="stat-number">35</div>
        <div class="stat-label">Total Endpoints</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">100%</div>
        <div class="stat-label">RESTful</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">10</div>
        <div class="stat-label">With Pagination</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">6</div>
        <div class="stat-label">Resources</div>
    </div>
</div>

<!-- ========================================
     PRODUCT MANAGEMENT
     ======================================== -->
<h2>1. Product Management</h2>

<!-- CREATE PRODUCT -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-post">POST</span>
        <span class="path">/api/v1/products</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Create a new product with initial inventory
    </div>

    <div class="section">
        <div class="section-title">Request Body</div>
        <pre>{
  "sku": "string",                    <span class="required">*required</span>
  "name": "string",                   <span class="required">*required</span>
  "description": "string",            <span class="optional">optional</span>
  "category": "string",               <span class="optional">optional</span>
  "basePrice": number,                <span class="required">*required, positive</span>
  "minimumOrderQuantity": integer,    <span class="required">*required, positive</span>
  "supplierId": long,                 <span class="required">*required</span>
  "unit": "string",                   <span class="optional">optional</span>
  "images": ["string"],               <span class="optional">optional</span>
  "colors": ["string"],               <span class="optional">optional</span>
  "sizes": ["string"]                 <span class="optional">optional</span>
}</pre>
    </div>

    <div class="section">
        <div class="section-title">Response Body (201 Created)</div>
        <pre>{
  "id": long,
  "sku": "string",
  "name": "string",
  "description": "string",
  "category": "string",
  "supplierId": long,
  "basePrice": number,
  "minimumOrderQuantity": integer,
  "unit": "string",
  "images": ["string"],
  "colors": ["string"],
  "sizes": ["string"],
  "createdAt": "2024-01-01T10:00:00",
  "updatedAt": "2024-01-01T10:00:00"
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Validate supplier ID exists → <span class="status-code">404 NOT FOUND</span> if not found</li>
            <li>Validate SKU format and uniqueness → <span class="status-code">400 BAD REQUEST</span> if invalid, <span class="status-code">409 CONFLICT</span> if exists</li>
            <li>Validate basePrice and minimumOrderQuantity are positive → <span class="status-code">400 BAD REQUEST</span> if invalid</li>
            <li><strong>BEGIN TRANSACTION</strong></li>
            <li>Create Product record</li>
            <li>Không cần tạo inventory cho record này (cái này chỉ nhầm mục đích hiển thị), add variant mới khởi tạo record inventory</li>
            <li>Product nao khong co variant thi luc order se khong cho order</li>
            <li><strong>COMMIT TRANSACTION</strong></li>
            <li>Return <span class="status-code">201 CREATED</span> with complete product details</li>
        </ol>
    </div>
</div>

<!-- LIST/FILTER PRODUCTS -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-get">GET</span>
        <span class="path">/api/v1/products</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        List and filter products with pagination
    </div>

    <div class="section">
        <div class="section-title">Query Parameters</div>
        <table class="field-table">
            <tr>
                <th>Parameter</th>
                <th>Type</th>
                <th>Required</th>
                <th>Description</th>
            </tr>
            <tr>
                <td><code>sku</code></td>
                <td>string</td>
                <td>No</td>
                <td>Filter by exact SKU match</td>
            </tr>
            <tr>
                <td><code>supplierId</code></td>
                <td>long</td>
                <td>No</td>
                <td>Filter products by supplier ID</td>
            </tr>
            <tr>
                <td><code>category</code></td>
                <td>string</td>
                <td>No</td>
                <td>Filter by category</td>
            </tr>
            <tr>
                <td><code>page</code></td>
                <td>integer</td>
                <td>No</td>
                <td>Page number (default: 0, zero-based)</td>
            </tr>
            <tr>
                <td><code>size</code></td>
                <td>integer</td>
                <td>No</td>
                <td>Page size (default: 20, max: 100)</td>
            </tr>
            <tr>
                <td><code>sort</code></td>
                <td>string</td>
                <td>No</td>
                <td>Sort criteria: field,direction (e.g., name,asc or createdAt,desc)</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
  "content": [
    {
      "id": long,
      "sku": "string",
      "name": "string",
      "description": "string",
      "category": "string",
      "supplierId": long,
      "basePrice": number,
      "minimumOrderQuantity": integer,
      "unit": "string",
      "colors": ["string"],
      "sizes": ["string"],
      "createdAt": "2024-01-01T10:00:00",
      "updatedAt": "2024-01-01T10:00:00"
    }
  ],
  "page": {
    "size": 20,
    "number": 0,
    "totalElements": 150,
    "totalPages": 8
  }
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Build query with all provided filters (sku, supplierId, category)</li>
            <li>Apply pagination parameters (page, size)</li>
            <li>Apply sorting if specified, default sort by createdAt descending</li>
            <li>Execute query and fetch page of results</li>
            <li>Return <span class="status-code">200 OK</span> with paginated response including total count</li>
            <li>If no products match filters, return empty array with totalElements = 0</li>
        </ol>
    </div>
</div>

<!-- GET PRODUCT BY ID -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-get">GET</span>
        <span class="path">/api/v1/products/{id}</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Retrieve product details by ID
    </div>

    <div class="section">
        <div class="section-title">Path Parameters</div>
        <table class="field-table">
            <tr>
                <th>Parameter</th>
                <th>Type</th>
                <th>Description</th>
            </tr>
            <tr>
                <td><code>id</code></td>
                <td>long</td>
                <td>Product ID</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
  "id": long,
  "sku": "string",
  "name": "string",
  "description": "string",
  "category": "string",
  "supplierId": long,
  "basePrice": number,
  "minimumOrderQuantity": integer,
  "unit": "string",
  "images": ["string"],
  "colors": ["string"],
  "sizes": ["string"],
  "createdAt": "2024-01-01T10:00:00",
  "updatedAt": "2024-01-01T10:00:00"
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Query Product by ID</li>
            <li>If product not found → <span class="status-code">404 NOT FOUND</span></li>
            <li>Return <span class="status-code">200 OK</span> with complete product details</li>
        </ol>
    </div>
</div>

<!-- PATCH PRODUCT -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-patch">PATCH</span>
        <span class="path">/api/v1/products/{id}</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Partially update product. Only provided fields are updated.
    </div>

    <div class="section">
        <div class="section-title">Path Parameters</div>
        <table class="field-table">
            <tr>
                <th>Parameter</th>
                <th>Type</th>
                <th>Description</th>
            </tr>
            <tr>
                <td><code>id</code></td>
                <td>long</td>
                <td>Product ID</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <div class="section-title">Request Body Examples</div>
        <pre>// Update specific fields
{
  "name": "New Product Name",
  "basePrice": 99.99
}

// Update multiple fields
{
  "name": "Updated Name",
  "description": "Updated description",
  "colors": ["Red", "Blue"],
  "sizes": ["S", "M", "L"]
}</pre>
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
  "id": long, // UUID
  "sku": "string",
  "name": "string",
  "description": "string",
  "category": "string",
  "supplierId": long,
  "basePrice": number,
  "minimumOrderQuantity": integer,
  "unit": "string",
  "colors": ["string"],
  "sizes": ["string"],
  "createdAt": "2024-01-01T10:00:00",
  "updatedAt": "2024-01-01T10:00:00"
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Query Product by ID → <span class="status-code">404 NOT FOUND</span> if not exists</li>
            <li>Validate provided fields:
                <ul>
                    <li>If basePrice provided, must be positive → <span class="status-code">400 BAD REQUEST</span></li>
                    <li>If minimumOrderQuantity provided, must be positive → <span class="status-code">400 BAD REQUEST</span></li>
                </ul>
            </li>
            <li>Update only the fields provided in request body</li>
            <li>Set updatedAt = current timestamp</li>
            <li>Return <span class="status-code">200 OK</span> with updated product details</li>
        </ol>
    </div>
</div>

<!-- DELETE PRODUCT -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-delete">DELETE</span>
        <span class="path">/api/v1/products/{id}</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Delete product
    </div>

    <div class="section">
        <div class="section-title">Path Parameters</div>
        <table class="field-table">
            <tr>
                <th>Parameter</th>
                <th>Type</th>
                <th>Description</th>
            </tr>
            <tr>
                <td><code>id</code></td>
                <td>long</td>
                <td>Product ID</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <div class="section-title">Response</div>
        <pre>204 No Content (empty body)</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Query Product by ID → <span class="status-code">404 NOT FOUND</span> if not exists</li>
            <li>Check if product has pending orders → <span class="status-code">400 BAD REQUEST</span> if cannot delete</li>
            <li>Delete Product record</li>
            <li>Return <span class="status-code">204 NO CONTENT</span></li>
        </ol>
    </div>
</div>

<!-- MANAGE PRODUCT VARIANTS -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-get">GET</span>
        <span class="path">/api/v1/products/{productId}/variants</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        List variants for a product with filtering by color and size
    </div>

    <div class="section">
        <div class="section-title">Path Parameters</div>
        <table class="field-table">
            <tr>
                <th>Parameter</th>
                <th>Type</th>
                <th>Description</th>
            </tr>
            <tr>
                <td><code>productId</code></td>
                <td>long</td>
                <td>Product ID</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <div class="section-title">Query Parameters</div>
        <table class="field-table">
            <tr>
                <th>Parameter</th>
                <th>Type</th>
                <th>Required</th>
                <th>Description</th>
            </tr>
            <tr>
                <td><code>color</code></td>
                <td>string</td>
                <td>No</td>
                <td>Filter by color</td>
            </tr>
            <tr>
                <td><code>size</code></td>
                <td>string</td>
                <td>No</td>
                <td>Filter by size</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
  "content": [
    {
      "id": long,
      "productId": long,
      "sku": "string",
      "color": "string",
      "size": "string",
      "priceAdjustment": number
    }
  ]
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Query Product by productId → <span class="status-code">404 NOT FOUND</span> if not exists</li>
            <li>Build query with color and size filters if provided</li>
            <li>Return <span class="status-code">200 OK</span> with list of variants</li>
        </ol>
    </div>
</div>

<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-post">POST</span>
        <span class="path">/api/v1/products/{productId}/variants</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Add a new variant to an existing product
    </div>

    <div class="section">
        <div class="section-title">Path Parameters</div>
        <table class="field-table">
            <tr>
                <th>Parameter</th>
                <th>Type</th>
                <th>Description</th>
            </tr>
            <tr>
                <td><code>productId</code></td>
                <td>long</td>
                <td>Product ID</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <div class="section-title">Request Body</div>
        <pre>{
  "sku": "string",                    <span class="required">*required</span>
  "color": "string",                  <span class="required">*required</span>
  "size": "string",                   <span class="required">*required</span>
  "priceAdjustment": number           <span class="optional">optional, default: 0</span>
}</pre>
    </div>

    <div class="section">
        <div class="section-title">Response Body (201 Created)</div>
        <pre>{
  "id": long,
  "productId": long,
  "sku": "string",
  "color": "string",
  "size": "string",
  "priceAdjustment": number,
  "createdAt": "2024-01-01T10:00:00"
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Query Product by productId → <span class="status-code">404 NOT FOUND</span> if not exists</li>
            <li>Validate sku, color, and size not empty → <span class="status-code">400 BAD REQUEST</span></li>
            <li>Check for duplicate variant (same productId + color + size combination) → <span class="status-code">409 CONFLICT</span></li>
            <li>Create ProductVariant record linked to product</li>
            <li>Create corresponding Inventory record with availableQuantity = 0, reservedQuantity = 0</li>
            <li>Inventory này là mặc định lúc tạo, lúc chỉnh sửa thì không quan tâm vì sẽ có portal để quản lý</li>
            <li>Return <span class="status-code">201 CREATED</span> with new variant details</li>
        </ol>
    </div>
</div>

<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-patch">PATCH</span>
        <span class="path">/api/v1/products/{productId}/variants/{variantId}</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Partially update an existing product variant
    </div>

    <div class="section">
        <div class="section-title">Path Parameters</div>
        <table class="field-table">
            <tr>
                <th>Parameter</th>
                <th>Type</th>
                <th>Description</th>
            </tr>
            <tr>
                <td><code>productId</code></td>
                <td>long</td>
                <td>Product ID</td>
            </tr>
            <tr>
                <td><code>variantId</code></td>
                <td>long</td>
                <td>Variant ID</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <div class="section-title">Request Body Examples</div>
        <pre>// Update specific fields
{
  "color": "Red",
  "priceAdjustment": 10.50
}

// Update multiple fields
{
  "sku": "PROD-001-RED-L",
  "color": "Red",
  "size": "Large",
  "priceAdjustment": 15.00
}</pre>
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
  "id": long,
  "productId": long,
  "sku": "string",
  "color": "string",
  "size": "string",
  "priceAdjustment": number,
  "updatedAt": "2024-01-01T10:00:00"
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Query Product by productId → <span class="status-code">404 NOT FOUND</span> if not exists</li>
            <li>Query ProductVariant by variantId → <span class="status-code">404 NOT FOUND</span> if not exists</li>
            <li>Verify variant belongs to product → <span class="status-code">400 BAD REQUEST</span> if mismatch</li>
            <li>If color or size provided, check for duplicate variant (excluding current variant) → <span class="status-code">409 CONFLICT</span></li>
            <li>Update only the fields provided in request body</li>
            <li>Set updatedAt = current timestamp</li>
            <li>Return <span class="status-code">200 OK</span> with updated variant details</li>
        </ol>
    </div>
</div>

<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-delete">DELETE</span>
        <span class="path">/api/v1/products/{productId}/variants/{variantId}</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Remove a variant from a product
    </div>

    <div class="section">
        <div class="section-title">Path Parameters</div>
        <table class="field-table">
            <tr>
                <td><code>productId</code></td>
                <td>long</td>
                <td>Product ID</td>
            </tr>
            <tr>
                <td><code>variantId</code></td>
                <td>long</td>
                <td>Variant ID</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <div class="section-title">Response</div>
        <pre>204 No Content (empty body)</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Query Product by productId → <span class="status-code">404 NOT FOUND</span> if not exists</li>
            <li>Query ProductVariant by variantId → <span class="status-code">404 NOT FOUND</span> if not exists</li>
            <li>Verify variant belongs to product → <span class="status-code">400 BAD REQUEST</span> if mismatch</li>
            <li>Check if product has only 1 variant remaining → <span class="status-code">400 BAD REQUEST</span> "Cannot remove last variant"</li>
            <li>Check if variant has pending orders (in OrderItems with order status = PENDING or CONFIRMED) → <span class="status-code">400 BAD REQUEST</span> "Variant has pending orders"</li>
            <li><strong>BEGIN TRANSACTION</strong></li>
            <li>Delete associated Inventory record</li>
            <li>Delete ProductVariant record</li>
            <li><strong>COMMIT TRANSACTION</strong></li>
            <li>Return <span class="status-code">204 NO CONTENT</span></li>
        </ol>
    </div>
</div>

<!-- MANAGE PRICE TIERS -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-get">GET</span>
        <span class="path">/api/v1/products/{productId}/price-tiers</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Get all price tiers for a product
    </div>

    <div class="section">
        <div class="section-title">Path Parameters</div>
        <table class="field-table">
            <tr>
                <th>Parameter</th>
                <th>Type</th>
                <th>Description</th>
            </tr>
            <tr>
                <td><code>productId</code></td>
                <td>long</td>
                <td>Product ID</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
  "content": [
    {
      "id": long,
      "minQuantity": integer,
      "maxQuantity": integer,
      "discountPercent": number
    }
  ]
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Query Product by productId → <span class="status-code">404 NOT FOUND</span> if not exists</li>
            <li>Query all PriceTiers for this product</li>
            <li>Return <span class="status-code">200 OK</span> with list of price tiers</li>
        </ol>
    </div>
</div>

<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-post">POST</span>
        <span class="path">/api/v1/products/{id}/price-tiers</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Add a new price tier to a product
    </div>

    <div class="section">
        <div class="section-title">Path Parameters</div>
        <table class="field-table">
            <tr>
                <td><code>id</code></td>
                <td>long</td>
                <td>Product ID</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <div class="section-title">Request Body</div>
        <pre>{
  "minQuantity": integer,             <span class="required">*required, positive</span>
  "maxQuantity": integer,             <span class="optional">optional, must be > minQuantity</span>
  "discountPercent": number           <span class="optional">optional, 0-100</span>
}</pre>
    </div>

    <div class="section">
        <div class="section-title">Response Body (201 Created)</div>
        <pre>{
  "id": long,
  "minQuantity": integer,
  "maxQuantity": integer,
  "discountPercent": number,
  "createdAt": "2024-01-01T10:00:00"
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Query Product by ID → <span class="status-code">404 NOT FOUND</span> if not exists</li>
            <li>Validate minQuantity is positive → <span class="status-code">400 BAD REQUEST</span></li>
            <li>If maxQuantity provided, validate maxQuantity > minQuantity → <span class="status-code">400 BAD REQUEST</span></li>
            <li>If discountPercent provided, validate 0 <= discountPercent <= 100 → <span class="status-code">400 BAD REQUEST</span></li>
            <li>Check for overlapping price tiers:
                <ul>
                    <li>Query existing PriceTiers for this product</li>
                    <li>If new tier's quantity range overlaps with existing tier → <span class="status-code">409 CONFLICT</span> "Price tier overlaps with existing tier"</li>
                </ul>
            </li>
            <li>Create PriceTier record linked to product</li>
            <li>Return <span class="status-code">201 CREATED</span> with new price tier details</li>
        </ol>
    </div>
</div>

<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-put">PUT</span>
        <span class="path">/api/v1/products/{productId}/price-tiers/{tierId}</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Update an existing price tier
    </div>

    <div class="section">
        <div class="section-title">Path Parameters</div>
        <table class="field-table">
            <tr>
                <td><code>productId</code></td>
                <td>long</td>
                <td>Product ID</td>
            </tr>
            <tr>
                <td><code>tierId</code></td>
                <td>long</td>
                <td>Price Tier ID</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <div class="section-title">Request Body</div>
        <pre>{
  "minQuantity": integer,             <span class="required">*required, positive</span>
  "maxQuantity": integer,             <span class="optional">optional, must be > minQuantity</span>
  "discountPercent": number           <span class="optional">optional, 0-100</span>
}</pre>
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
  "id": long,
  "minQuantity": integer,
  "maxQuantity": integer,
  "discountPercent": number,
  "updatedAt": "2024-01-01T10:00:00"
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Query Product by productId → <span class="status-code">404 NOT FOUND</span> if not exists</li>
            <li>Query PriceTier by tierId → <span class="status-code">404 NOT FOUND</span> if not exists</li>
            <li>Verify price tier belongs to product → <span class="status-code">400 BAD REQUEST</span> if mismatch</li>
            <li>Validate minQuantity is positive → <span class="status-code">400 BAD REQUEST</span></li>
            <li>If maxQuantity provided, validate maxQuantity > minQuantity → <span class="status-code">400 BAD REQUEST</span></li>
            <li>If discountPercent provided, validate 0 <= discountPercent <= 100 → <span class="status-code">400 BAD REQUEST</span></li>
            <li>Check for overlapping price tiers (excluding current tier) → <span class="status-code">409 CONFLICT</span></li>
            <li>Update PriceTier record with all provided fields</li>
            <li>Set updatedAt = current timestamp</li>
            <li>Return <span class="status-code">200 OK</span> with updated price tier</li>
        </ol>
    </div>
</div>

<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-delete">DELETE</span>
        <span class="path">/api/v1/products/{productId}/price-tiers/{tierId}</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Remove a price tier from a product
    </div>

    <div class="section">
        <div class="section-title">Path Parameters</div>
        <table class="field-table">
            <tr>
                <td><code>productId</code></td>
                <td>long</td>
                <td>Product ID</td>
            </tr>
            <tr>
                <td><code>tierId</code></td>
                <td>long</td>
                <td>Price Tier ID</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <div class="section-title">Response</div>
        <pre>204 No Content (empty body)</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Query Product by productId → <span class="status-code">404 NOT FOUND</span> if not exists</li>
            <li>Query PriceTier by tierId → <span class="status-code">404 NOT FOUND</span> if not exists</li>
            <li>Verify price tier belongs to product → <span class="status-code">400 BAD REQUEST</span> if mismatch</li>
            <li>Delete PriceTier record</li>
            <li>Return <span class="status-code">204 NO CONTENT</span></li>
        </ol>
    </div>
</div>

<!-- ========================================
     SUPPLIER MANAGEMENT
     ======================================== -->
<h2>2. Supplier Management</h2>

<!-- CREATE SUPPLIER -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-post">POST</span>
        <span class="path">/api/v1/suppliers</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Register a new supplier with business information
    </div>

    <div class="section">
        <div class="section-title">Request Body</div>
        <pre>{
  "name": "string",                   <span class="required">*required</span>
  "email": "string",                  <span class="required">*required, email format</span>
  "phone": "string",                  <span class="optional">optional</span>
  "address": "string",                <span class="optional">optional</span>
  "profilePicture": "string",         <span class="optional">optional, URL</span>
  "profileDescription": "string",     <span class="optional">optional</span>
  "businessLicense": "string"         <span class="optional">optional</span>
}</pre>
    </div>

    <div class="section">
        <div class="section-title">Response Body (201 Created)</div>
        <pre>{
  "id": long,
  "name": "string",
  "email": "string",
  "phone": "string",
  "address": "string",
  "profilePicture": "string",
  "profileDescription": "string",
  "businessLicense": "string",
  "status": "ACTIVE",
  "createdAt": "2024-01-01T10:00:00",
  "updatedAt": "2024-01-01T10:00:00"
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Validate name not empty → <span class="status-code">400 BAD REQUEST</span></li>
            <li>Validate email format → <span class="status-code">400 BAD REQUEST</span> if invalid</li>
            <li>Check email uniqueness → <span class="status-code">409 CONFLICT</span> if exists</li>
            <li>If businessLicense provided, check uniqueness → <span class="status-code">409 CONFLICT</span> if exists</li>
            <li>Create Supplier record with status = ACTIVE</li>
            <li>Return <span class="status-code">201 CREATED</span> with supplier details</li>
        </ol>
    </div>
</div>

<!-- LIST SUPPLIERS -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-get">GET</span>
        <span class="path">/api/v1/suppliers</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        List suppliers with pagination
    </div>

    <div class="section">
        <div class="section-title">Query Parameters</div>
        <table class="field-table">
            <tr>
                <th>Parameter</th>
                <th>Type</th>
                <th>Description</th>
            </tr>
            <tr>
                <td><code>status</code></td>
                <td>string</td>
                <td>Filter by status (ACTIVE, INACTIVE)</td>
            </tr>
            <tr>
                <td><code>page</code></td>
                <td>integer</td>
                <td>Page number (default: 0)</td>
            </tr>
            <tr>
                <td><code>size</code></td>
                <td>integer</td>
                <td>Page size (default: 20, max: 100)</td>
            </tr>
            <tr>
                <td><code>sort</code></td>
                <td>string</td>
                <td>Sort criteria (e.g., name,asc)</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
  "content": [
    {
      "id": long,
      "name": "string",
      "email": "string",
      "phone": "string",
      "address": "string",
      "status": "ACTIVE" | "INACTIVE",
      "createdAt": "2024-01-01T10:00:00"
    }
  ],
  "page": {
    "size": 20,
    "number": 0,
    "totalElements": 50,
    "totalPages": 3
  }
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Build query with status filter if provided</li>
            <li>Apply pagination and sorting</li>
            <li>Execute query and return <span class="status-code">200 OK</span> with paginated results</li>
        </ol>
    </div>
</div>

<!-- GET SUPPLIER BY ID -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-get">GET</span>
        <span class="path">/api/v1/suppliers/{id}</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Retrieve supplier details by ID
    </div>

    <div class="section">
        <div class="section-title">Path Parameters</div>
        <table class="field-table">
            <tr>
                <td><code>id</code></td>
                <td>long</td>
                <td>Supplier ID</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
  "id": long,
  "name": "string",
  "email": "string",
  "phone": "string",
  "address": "string",
  "profilePicture": "string",
  "profileDescription": "string",
  "businessLicense": "string",
  "status": "ACTIVE" | "INACTIVE",
  "createdAt": "2024-01-01T10:00:00",
  "updatedAt": "2024-01-01T10:00:00"
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Query Supplier by ID</li>
            <li>If not found → <span class="status-code">404 NOT FOUND</span></li>
            <li>Return <span class="status-code">200 OK</span> with supplier details</li>
        </ol>
    </div>
</div>

<!-- UPDATE SUPPLIER -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-put">PUT</span>
        <span class="path">/api/v1/suppliers/{id}</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Update supplier profile information (full update)
    </div>

    <div class="section">
        <div class="section-title">Request Body</div>
        <pre>{
  "name": "string",                   <span class="required">*required</span>
  "phone": "string",                  <span class="required">*required</span>
  "address": "string",                <span class="required">*required</span>
  "profileDescription": "string"      <span class="optional">optional</span>
}</pre>
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
  "id": long,
  "name": "string",
  "email": "string",
  "phone": "string",
  "address": "string",
  "profilePicture": "string",
  "profileDescription": "string",
  "businessLicense": "string",
  "status": "ACTIVE" | "INACTIVE",
  "createdAt": "2024-01-01T10:00:00",
  "updatedAt": "2024-01-01T10:00:00"
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Query Supplier by ID → <span class="status-code">404 NOT FOUND</span> if not exists</li>
            <li>Validate required fields → <span class="status-code">400 BAD REQUEST</span> if missing</li>
            <li>Update Supplier record with provided fields</li>
            <li>Set updatedAt = current timestamp</li>
            <li>Return <span class="status-code">200 OK</span> with updated supplier</li>
        </ol>
    </div>
</div>

<!-- PATCH SUPPLIER -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-patch">PATCH</span>
        <span class="path">/api/v1/suppliers/{id}</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Partially update supplier (e.g., status change)
    </div>

    <div class="section">
        <div class="section-title">Request Body Example</div>
        <pre>{
  "status": "ACTIVE" | "INACTIVE"
}</pre>
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
  "id": long,
  "name": "string",
  "email": "string",
  "status": "ACTIVE" | "INACTIVE",
  "updatedAt": "2024-01-01T10:00:00"
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Query Supplier by ID → <span class="status-code">404 NOT FOUND</span> if not exists</li>
            <li>Validate provided fields → <span class="status-code">400 BAD REQUEST</span> if invalid</li>
            <li>Update only provided fields</li>
            <li>Return <span class="status-code">200 OK</span></li>
        </ol>
    </div>
</div>

<!-- ========================================
     RETAILER MANAGEMENT
     ======================================== -->
<h2>3. Retailer Management</h2>

<!-- CREATE RETAILER -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-post">POST</span>
        <span class="path">/api/v1/retailers</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Register a new retailer with business information
    </div>

    <div class="section">
        <div class="section-title">Request Body</div>
        <pre>{
  "name": "string",                   <span class="required">*required</span>
  "email": "string",                  <span class="required">*required, email format</span>
  "phone": "string",                  <span class="optional">optional</span>
  "address": "string",                <span class="optional">optional</span>
  "profilePicture": "string",         <span class="optional">optional, URL</span>
  "profileDescription": "string",     <span class="optional">optional</span>
  "businessLicense": "string",        <span class="optional">optional</span>
  "creditLimit": number               <span class="optional">optional, default: 0</span>
}</pre>
    </div>

    <div class="section">
        <div class="section-title">Response Body (201 Created)</div>
        <pre>{
  "id": long,
  "name": "string",
  "email": "string",
  "phone": "string",
  "address": "string",
  "profilePicture": "string",
  "profileDescription": "string",
  "businessLicense": "string",
  "creditLimit": number,
  "loyaltyPoints": 0,
  "status": "ACTIVE",
  "createdAt": "2024-01-01T10:00:00",
  "updatedAt": "2024-01-01T10:00:00"
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Validate name not empty → <span class="status-code">400 BAD REQUEST</span></li>
            <li>Validate email format → <span class="status-code">400 BAD REQUEST</span> if invalid</li>
            <li>Check email uniqueness → <span class="status-code">409 CONFLICT</span> if exists</li>
            <li>If businessLicense provided, check uniqueness → <span class="status-code">409 CONFLICT</span> if exists</li>
            <li>Create Retailer record with status = ACTIVE, loyaltyPoints = 0</li>
            <li>Return <span class="status-code">201 CREATED</span> with retailer details</li>
        </ol>
    </div>
</div>

<!-- LIST RETAILERS -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-get">GET</span>
        <span class="path">/api/v1/retailers</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        List retailers with pagination
    </div>

    <div class="section">
        <div class="section-title">Query Parameters</div>
        <table class="field-table">
            <tr>
                <td><code>status</code></td>
                <td>string</td>
                <td>Filter by status (ACTIVE, INACTIVE)</td>
            </tr>
            <tr>
                <td><code>page</code></td>
                <td>integer</td>
                <td>Page number (default: 0)</td>
            </tr>
            <tr>
                <td><code>size</code></td>
                <td>integer</td>
                <td>Page size (default: 20, max: 100)</td>
            </tr>
            <tr>
                <td><code>sort</code></td>
                <td>string</td>
                <td>Sort criteria (e.g., name,asc)</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
  "content": [
    {
      "id": long,
      "name": "string",
      "email": "string",
      "phone": "string",
      "loyaltyPoints": number,
      "status": "ACTIVE" | "INACTIVE",
      "createdAt": "2024-01-01T10:00:00"
    }
  ],
  "page": {
    "size": 20,
    "number": 0,
    "totalElements": 75,
    "totalPages": 4
  }
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Build query with status filter if provided</li>
            <li>Apply pagination and sorting</li>
            <li>Return <span class="status-code">200 OK</span> with paginated results</li>
        </ol>
    </div>
</div>

<!-- GET RETAILER BY ID -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-get">GET</span>
        <span class="path">/api/v1/retailers/{id}</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Retrieve retailer details by ID
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
  "id": long,
  "name": "string",
  "email": "string",
  "phone": "string",
  "address": "string",
  "profilePicture": "string",
  "profileDescription": "string",
  "businessLicense": "string",
  "creditLimit": number,
  "loyaltyPoints": number,
  "status": "ACTIVE" | "INACTIVE",
  "createdAt": "2024-01-01T10:00:00",
  "updatedAt": "2024-01-01T10:00:00"
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Query Retailer by ID</li>
            <li>If not found → <span class="status-code">404 NOT FOUND</span></li>
            <li>Return <span class="status-code">200 OK</span> with retailer details</li>
        </ol>
    </div>
</div>

<!-- UPDATE RETAILER -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-put">PUT</span>
        <span class="path">/api/v1/retailers/{id}</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Update retailer profile information (full update)
    </div>

    <div class="section">
        <div class="section-title">Request Body</div>
        <pre>{
  "name": "string",                   <span class="required">*required</span>
  "phone": "string",                  <span class="required">*required</span>
  "address": "string",                <span class="required">*required</span>
  "profileDescription": "string"      <span class="optional">optional</span>
}</pre>
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
  "id": long,
  "name": "string",
  "email": "string",
  "phone": "string",
  "address": "string",
  "profileDescription": "string",
  "loyaltyPoints": number,
  "status": "ACTIVE" | "INACTIVE",
  "updatedAt": "2024-01-01T10:00:00"
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Query Retailer by ID → <span class="status-code">404 NOT FOUND</span> if not exists</li>
            <li>Validate required fields → <span class="status-code">400 BAD REQUEST</span> if missing</li>
            <li>Update Retailer record</li>
            <li>Return <span class="status-code">200 OK</span></li>
        </ol>
    </div>
</div>

<!-- PATCH RETAILER -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-patch">PATCH</span>
        <span class="path">/api/v1/retailers/{id}</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Partially update retailer (status change, loyalty points management)
    </div>

    <div class="section">
        <div class="section-title">Request Body Examples</div>
        <pre>// Change status
{
  "status": "ACTIVE" | "INACTIVE"
}

// Manage loyalty points
{
  "loyaltyPoints": {
    "operation": "ADD" | "REDEEM",
    "amount": 100
  }
}</pre>
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
  "id": long,
  "name": "string",
  "email": "string",
  "loyaltyPoints": number,
  "status": "ACTIVE" | "INACTIVE",
  "updatedAt": "2024-01-01T10:00:00"
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Query Retailer by ID → <span class="status-code">404 NOT FOUND</span> if not exists</li>
            <li>If loyaltyPoints operation provided:
                <ul>
                    <li>Validate operation is ADD or REDEEM → <span class="status-code">400 BAD REQUEST</span></li>
                    <li>Validate amount is positive → <span class="status-code">400 BAD REQUEST</span></li>
                    <li>If ADD: loyaltyPoints = loyaltyPoints + amount</li>
                    <li>If REDEEM: Check loyaltyPoints >= amount → <span class="status-code">400 BAD REQUEST</span> if insufficient</li>
                    <li>If REDEEM: loyaltyPoints = loyaltyPoints - amount</li>
                </ul>
            </li>
            <li>If status provided, update status field</li>
            <li>Return <span class="status-code">200 OK</span></li>
        </ol>
    </div>
</div>

<!-- ========================================
     ORDER MANAGEMENT
     ======================================== -->
<h2>4. Order Management</h2>

<!-- CREATE ORDER -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-post">POST</span>
        <span class="path">/api/v1/orders</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Place a new order. System validates entities, checks inventory, and reserves stock.
    </div>

    <div class="section">
        <div class="section-title">Request Body</div>
        <pre>{
  "orderNumber": "string",            <span class="required">*required, unique</span>
  "retailerId": long,                 <span class="required">*required</span>
  "supplierId": long,                 <span class="required">*required</span>
  "shippingAddress": "string",        <span class="required">*required</span>
  "orderItems": [                     <span class="required">*required, min 1 item</span>
    {
      "variantId": long,              <span class="required">*required</span>
      "quantity": integer,            <span class="required">*required, positive</span>
      "price": number,                <span class="required">*required, positive</span>
      "productName": "string"         <span class="required">*required</span>
    }
  ]
}</pre>
    </div>

    <div class="section">
        <div class="section-title">Response Body (201 Created)</div>
        <pre>{
  "id": long,
  "orderNumber": "string",
  "retailerId": long,
  "supplierId": long,
  "status": "PENDING",
  "totalAmount": number,
  "shippingAddress": "string",
  "deliveryDate": null // by default null,
  "orderDate": "2024-01-01T10:00:00" // by default current timestamp,
  "items": [
    {
      "id": long,
      "variantId": long,
      "productName": "string",
      "quantity": integer,
      "price": number,
      "finalTotalPrice": number,
      "color": "string",
      "size": "string"
    }
  ],
  "createdAt": "2024-01-01T10:00:00",
  "updatedAt": "2024-01-01T10:00:00"
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Validate orderNumber is unique → <span class="status-code">409 CONFLICT</span> if exists</li>
            <li>Validate retailerId exists → <span class="status-code">404 NOT FOUND</span> if not found</li>
            <li>Validate supplierId exists → <span class="status-code">404 NOT FOUND</span> if not found</li>
            <li>Validate orderItems is not empty → <span class="status-code">400 BAD REQUEST</span> if empty</li>
            <li>For each orderItem:
                <ul>
                    <li>Validate variantId exists → <span class="status-code">404 NOT FOUND</span> if not found</li>
                    <li>Validate quantity is positive → <span class="status-code">400 BAD REQUEST</span></li>
                    <li>Validate price is positive → <span class="status-code">400 BAD REQUEST</span></li>
                </ul>
            </li>
            <li><strong>BEGIN TRANSACTION</strong></li>
            <li>For each orderItem:
                <ul>
                    <li>Query ProductVariant by variantId to get productId, color, size</li>
                    <li>Query Inventory for variantId (or productId + supplierId)</li>
                    <li>If inventory not found → <span class="status-code">404 NOT FOUND</span> "Variant not stocked by supplier"</li>
                    <li>Calculate available stock = availableQuantity - reservedQuantity</li>
                    <li>If quantity > available stock → <span class="status-code">409 CONFLICT</span> "Insufficient stock"</li>
                    <li>Update Inventory: reservedQuantity += quantity (using SELECT FOR UPDATE to prevent race conditions)</li>
                    <li><strong>Calculate price:</strong> price = ((basePrice + priceAdjustment) × quantity) × (1 - priceTier.discount)
                        <ul>
                            <li>Get product basePrice and variant priceAdjustment</li>
                            <li>Find applicable price tier based on quantity</li>
                            <li>Apply discount if price tier exists</li>
                        </ul>
                    </li>
                    <li>Set finalTotalPrice = price</li>
                </ul>
            </li>
            <li>Calculate totalAmount = sum of price for all items</li>
            <li>Set orderDate = current timestamp (if status is PENDING and orderDate is null)</li>
            <li>Create Order record with status = PENDING, orderDate = current timestamp</li>
            <li>Create OrderItem records for each item (including variantId, color, size)</li>
            <li><strong>COMMIT TRANSACTION</strong></li>
            <li>Return <span class="status-code">201 CREATED</span> with complete order details</li>
        </ol>
    </div>
</div>

<!-- LIST ORDERS -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-get">GET</span>
        <span class="path">/api/v1/orders</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        List orders with filtering and pagination
    </div>

    <div class="section">
        <div class="section-title">Query Parameters</div>
        <table class="field-table">
            <tr>
                <td><code>retailerId</code></td>
                <td>long</td>
                <td>Filter by retailer ID</td>
            </tr>
            <tr>
                <td><code>supplierId</code></td>
                <td>long</td>
                <td>Filter by supplier ID</td>
            </tr>
            <tr>
                <td><code>status</code></td>
                <td>string</td>
                <td>Filter by status (PENDING, CONFIRMED, SHIPPED, DELIVERED, CANCELLED)</td>
            </tr>
            <tr>
                <td><code>page</code></td>
                <td>integer</td>
                <td>Page number (default: 0)</td>
            </tr>
            <tr>
                <td><code>size</code></td>
                <td>integer</td>
                <td>Page size (default: 20, max: 100)</td>
            </tr>
            <tr>
                <td><code>sort</code></td>
                <td>string</td>
                <td>Sort criteria (e.g., orderDate,desc)</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
  "content": [
    {
      "id": long,
      "orderNumber": "string",
      "retailerId": long,
      "supplierId": long,
      "status": "PENDING" | "CONFIRMED" | "SHIPPED" | "DELIVERED" | "CANCELLED",
      "totalAmount": number,
      "orderDate": "2024-01-01T10:00:00",
      "deliveryDate": "2024-01-05T10:00:00",
      "createdAt": "2024-01-01T10:00:00",
      "updatedAt": "2024-01-01T10:00:00"
    }
  ],
  "page": {
    "size": 20,
    "number": 0,
    "totalElements": 200,
    "totalPages": 10
  }
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Build query with all provided filters (retailerId, supplierId, status)</li>
            <li>Apply pagination and sorting (default: orderDate descending)</li>
            <li>Return <span class="status-code">200 OK</span> with paginated results</li>
        </ol>
    </div>
</div>

<!-- GET ORDER BY ID -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-get">GET</span>
        <span class="path">/api/v1/orders/{id}</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Retrieve order details by ID including all items
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
  "id": long,
  "orderNumber": "string",
  "retailerId": long,
  "supplierId": long,
  "status": "PENDING" | "CONFIRMED" | "SHIPPED" | "DELIVERED" | "CANCELLED",
  "totalAmount": number,
  "shippingAddress": "string",
  "orderDate": "2024-01-01T10:00:00",
  "deliveryDate": "2024-01-05T10:00:00",
  "items": [
    {
      "id": long,
      "variantId": long,
      "productName": "string",
      "quantity": integer,
      "price": number,
      "finalTotalPrice": number,
      "color": "string",
      "size": "string"
    }
  ],
  "createdAt": "2024-01-01T10:00:00",
  "updatedAt": "2024-01-01T10:00:00"
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Query Order by ID</li>
            <li>If not found → <span class="status-code">404 NOT FOUND</span></li>
            <li>Fetch associated OrderItems</li>
            <li>Return <span class="status-code">200 OK</span> with complete order details</li>
        </ol>
    </div>
</div>

<!-- PATCH ORDER -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-patch">PATCH</span>
        <span class="path">/api/v1/orders/{id}</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Update order: final price of each item, status, or delivery date. Status flow: PENDING → CONFIRMED → SHIPPED → DELIVERED (or any status → CANCELLED)
    </div>

    <div class="section">
        <div class="section-title">Request Body Examples</div>
        <pre>// Update status
{
  "status": "CONFIRMED" | "SHIPPED" | "DELIVERED" | "CANCELLED"
}

// Update delivery date
{
  "deliveryDate": "2024-01-05T10:00:00"
}

// Update final price of items
{
  "items": [
    {
      "id": long,
      "finalTotalPrice": number
    }
  ]
}

// Update multiple fields
{
  "status": "CONFIRMED",
  "deliveryDate": "2024-01-05T10:00:00",
  "items": [
    {
      "id": long,
      "finalTotalPrice": number
    }
  ]
}</pre>
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
            "id": long,
            "orderNumber": "string",
            "retailerId": long,
            "supplierId": long,
            "status": "PENDING" | "CONFIRMED" | "SHIPPED" | "DELIVERED" | "CANCELLED",
            "totalAmount": number,
            "shippingAddress": "string",
            "orderDate": "2024-01-01T10:00:00",
            "deliveryDate": "2024-01-05T10:00:00",
            "items": [
              {
                "id": long,
                "variantId": long,
                "productName": "string",
                "quantity": integer,
                "price": number,
                "finalTotalPrice": number,
                "color": "string",
                "size": "string"
              }
            ],
            "createdAt": "2024-01-01T10:00:00",
            "updatedAt": "2024-01-01T10:00:00"
    }</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Query Order by ID → <span class="status-code">404 NOT FOUND</span> if not exists</li>
            <li>If status provided:
                <ul>
                    <li>Validate status is valid enum → <span class="status-code">400 BAD REQUEST</span></li>
                    <li>Validate status transition is allowed:
                        <ul>
                            <li>PENDING → CONFIRMED: allowed</li>
                            <li>CONFIRMED → SHIPPED: allowed</li>
                            <li>SHIPPED → DELIVERED: allowed</li>
                            <li>Any status → CANCELLED: allowed (if not DELIVERED)</li>
                            <li>Other transitions: <span class="status-code">400 BAD REQUEST</span> "Invalid status transition"</li>
                        </ul>
                    </li>
                    <li><strong>If new status == SHIPPED:</strong>
                        <ul>
                            <li><strong>BEGIN TRANSACTION</strong></li>
                            <li>Query all OrderItems for this order</li>
                            <li>For each OrderItem:
                                <ul>
                                    <li>Update Inventory: availableQuantity -= quantity</li>
                                    <li>Update Inventory: reservedQuantity -= quantity</li>
                                </ul>
                            </li>
                            <li>Update Order status to SHIPPED</li>
                            <li><strong>COMMIT TRANSACTION</strong></li>
                        </ul>
                    </li>
                    <li><strong>If new status == CANCELLED:</strong>
                        <ul>
                            <li>Check current status is not SHIPPED or DELIVERED → <span class="status-code">400 BAD REQUEST</span></li>
                            <li><strong>BEGIN TRANSACTION</strong></li>
                            <li>Query all OrderItems for this order</li>
                            <li>For each OrderItem:
                                <ul>
                                    <li>Update Inventory: reservedQuantity -= quantity (release reserved stock)</li>
                                </ul>
                            </li>
                            <li>Update Order status to CANCELLED</li>
                            <li><strong>COMMIT TRANSACTION</strong></li>
                        </ul>
                    </li>
                    <li><strong>For other status updates:</strong> Simply update status field</li>
                </ul>
            </li>
            <li>If deliveryDate provided: Update deliveryDate field</li>
            <li>If items provided:
                <ul>
                    <li>For each item in request:
                        <ul>
                            <li>Query OrderItem by id → <span class="status-code">404 NOT FOUND</span> if not exists</li>
                            <li>Verify OrderItem belongs to this order → <span class="status-code">400 BAD REQUEST</span> if mismatch</li>
                            <li>Validate finalTotalPrice is positive → <span class="status-code">400 BAD REQUEST</span></li>
                            <li>Update OrderItem.finalTotalPrice = provided finalTotalPrice</li>
                        </ul>
                    </li>
                    <li>Recalculate totalAmount = sum of finalTotalPrice for all items</li>
                    <li>Update Order.totalAmount</li>
                </ul>
            </li>
            <li>Set updatedAt = current timestamp</li>
            <li>Return <span class="status-code">200 OK</span> with updated order</li>
        </ol>
    </div>
</div>

<!-- ========================================
     INVENTORY MANAGEMENT
     ======================================== -->
<h2>5. Inventory Management</h2>

<!-- GET INVENTORY BY PRODUCT -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-get">GET</span>
        <span class="path">/api/v1/products/{productId}/variants/{variantId}/inventory</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Get inventory details for a specific variant
    </div>

    <div class="section">
        <div class="section-title">Path Parameters</div>
        <table class="field-table">
            <tr>
                <th>Parameter</th>
                <th>Type</th>
                <th>Description</th>
            </tr>
            <tr>
                <td><code>productId</code></td>
                <td>long</td>
                <td>Product ID</td>
            </tr>
            <tr>
                <td><code>variantId</code></td>
                <td>long</td>
                <td>Variant ID</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
  "id": long,
  "productId": long,
  "variantId": long,
  "supplierId": long,
  "availableQuantity": integer,
  "reservedQuantity": integer,
  "reorderLevel": integer,
  "reorderQuantity": integer,
  "warehouseLocation": "string",
  "lastRestocked": "2024-01-01T10:00:00",
  "lastUpdated": "2024-01-01T10:00:00",
  "status": "AVAILABLE" | "LOW_STOCK" | "OUT_OF_STOCK" | "DISCONTINUED"
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Query Inventory by productId and variantId (if provided)</li>
            <li>If not found → <span class="status-code">404 NOT FOUND</span></li>
            <li>Return <span class="status-code">200 OK</span> with inventory details</li>
        </ol>
    </div>
</div>

<!-- LIST INVENTORY BY SUPPLIER -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-get">GET</span>
        <span class="path">/api/v1/suppliers/{supplierId}/inventory</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Get all inventory items for a supplier with pagination
    </div>

    <div class="section">
        <div class="section-title">Query Parameters</div>
        <table class="field-table">
            <tr>
                <th>Parameter</th>
                <th>Type</th>
                <th>Required</th>
                <th>Description</th>
            </tr>
            <tr>
                <td><code>productId</code></td>
                <td>long</td>
                <td>No</td>
                <td>Filter by product ID</td>
            </tr>
            <tr>
                <td><code>variantId</code></td>
                <td>long</td>
                <td>No</td>
                <td>Filter by variant ID</td>
            </tr>
            <tr>
                <td><code>needsReorder</code></td>
                <td>boolean</td>
                <td>No</td>
                <td>Filter items where availableQuantity <= reorderLevel</td>
            </tr>
            <tr>
                <td><code>page</code></td>
                <td>integer</td>
                <td>No</td>
                <td>Page number (default: 0)</td>
            </tr>
            <tr>
                <td><code>size</code></td>
                <td>integer</td>
                <td>No</td>
                <td>Page size (default: 20, max: 100)</td>
            </tr>
            <tr>
                <td><code>sort</code></td>
                <td>string</td>
                <td>No</td>
                <td>Sort criteria (e.g., availableQuantity,asc)</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
  "content": [
    {
      "id": long,
      "productId": long,
      "variantId": long,
      "supplierId": long,
      "availableQuantity": integer,
      "reservedQuantity": integer,
      "reorderLevel": integer,
      "reorderQuantity": integer,
      "warehouseLocation": "string",
      "lastRestocked": "2024-01-01T10:00:00",
      "lastUpdated": "2024-01-01T10:00:00",
      "status": "AVAILABLE" | "LOW_STOCK" | "OUT_OF_STOCK" | "DISCONTINUED"
    }
  ],
  "page": {
    "size": 20,
    "number": 0,
    "totalElements": 100,
    "totalPages": 5
  }
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Query Inventory records by supplierId</li>
            <li>Apply filters: productId, variantId (if provided)</li>
            <li>If needsReorder=true, filter where availableQuantity <= reorderLevel</li>
            <li>Apply pagination and sorting</li>
            <li>Return <span class="status-code">200 OK</span> with paginated results</li>
        </ol>
    </div>
</div>

<!-- PATCH INVENTORY -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-patch">PATCH</span>
        <span class="path">/api/v1/products/{productId}/variants/{variantId}/inventory</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Update available quantity for inventory. The availableQuantity must not be less than reservedQuantity.
    </div>

    <div class="section">
        <div class="section-title">Path Parameters</div>
        <table class="field-table">
            <tr>
                <th>Parameter</th>
                <th>Type</th>
                <th>Description</th>
            </tr>
            <tr>
                <td><code>productId</code></td>
                <td>long</td>
                <td>Product ID</td>
            </tr>
            <tr>
                <td><code>variantId</code></td>
                <td>long</td>
                <td>Variant ID</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <div class="section-title">Request Body</div>
        <pre>{
  "availableQuantity": integer   
  "reorderLevel": integer
  "reorderQuantity": integer
  "warehouseLocation": "string"     
}</pre>
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
  "id": long,
  "productId": long,
  "variantId": long,
  "supplierId": long,
  "availableQuantity": integer,
  "reservedQuantity": integer,
  "reorderLevel": integer,
  "reorderQuantity": integer,
  "warehouseLocation": "string",
  "lastRestocked": "2024-01-01T10:00:00",
  "lastUpdated": "2024-01-01T10:00:00",
  "status": "AVAILABLE" | "LOW_STOCK" | "OUT_OF_STOCK" | "DISCONTINUED"
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Query Inventory by productId and variantId (if provided) → <span class="status-code">404 NOT FOUND</span> if not exists</li>
            <li>Validate availableQuantity is provided → <span class="status-code">400 BAD REQUEST</span> if missing</li>
            <li>Validate availableQuantity >= reservedQuantity → <span class="status-code">400 BAD REQUEST</span> "availableQuantity cannot be less than reservedQuantity"</li>
            <li>Update Inventory.availableQuantity = provided availableQuantity</li>
            <li>Set updatedAt = current timestamp</li>
            <li>Return <span class="status-code">200 OK</span> with updated inventory</li>
        </ol>
    </div>
</div>

<!-- ========================================
     QUOTATION MANAGEMENT
     ======================================== -->
<h2>6. Quotation Management</h2>

<!-- CREATE QUOTATION REQUEST -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-post">POST</span>
        <span class="path">/api/v1/quotations/requests</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Create a new quotation request from retailer to supplier
    </div>

    <div class="section">
        <div class="section-title">Request Body</div>
        <pre>{
  "retailerId": long,                 <span class="required">*required</span>
  "supplierId": long,                 <span class="required">*required</span>
  "items": [                          <span class="required">*required, min 1</span>
    {
      "productId": long,              <span class="required">*required</span>
      "variantId": long,              <span class="optional">optional</span>
      "quantity": integer,            <span class="required">*required, min: 1</span>
      "specifications": "string"      <span class="optional">optional</span>
    }
  ],
  "validUntil": "2024-01-31T23:59:59", <span class="required">*required, future date</span>
  "notes": "string"                   <span class="optional">optional</span>
}</pre>
    </div>

    <div class="section">
        <div class="section-title">Response Body (201 Created)</div>
        <pre>{
  "requestId": long,
  "status": "DRAFT",
  "message": "Quotation request created successfully"
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Validate retailerId exists → <span class="status-code">404 NOT FOUND</span></li>
            <li>Validate supplierId exists → <span class="status-code">404 NOT FOUND</span></li>
            <li>Validate items not empty → <span class="status-code">400 BAD REQUEST</span></li>
            <li>For each item:
                <ul>
                    <li>Validate productId exists → <span class="status-code">404 NOT FOUND</span></li>
                    <li>If variantId provided, validate variantId exists and belongs to productId → <span class="status-code">404 NOT FOUND</span> or <span class="status-code">400 BAD REQUEST</span></li>
                    <li>Validate quantity > 0 → <span class="status-code">400 BAD REQUEST</span></li>
                </ul>
            </li>
            <li>Validate validUntil is future date → <span class="status-code">400 BAD REQUEST</span></li>
            <li>Generate unique request number</li>
            <li>Create QuotationRequest record with status = DRAFT</li>
            <li>Create QuotationRequestItem records for each item</li>
            <li>Return <span class="status-code">201 CREATED</span> with request ID</li>
        </ol>
    </div>
</div>

<!-- LIST QUOTATION REQUESTS -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-get">GET</span>
        <span class="path">/api/v1/quotations/requests</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        List quotation requests with pagination
    </div>

    <div class="section">
        <div class="section-title">Query Parameters</div>
        <table class="field-table">
            <tr>
                <td><code>retailerId</code></td>
                <td>long</td>
                <td>Filter by retailer ID</td>
            </tr>
            <tr>
                <td><code>supplierId</code></td>
                <td>long</td>
                <td>Filter by supplier ID</td>
            </tr>
            <tr>
                <td><code>status</code></td>
                <td>string</td>
                <td>Filter by status (DRAFT, ACCEPTED, CANCELLED)</td>
            </tr>
            <tr>
                <td><code>page, size, sort</code></td>
                <td></td>
                <td>Standard pagination parameters</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
  "content": [
    {
      "requestId": long,
      "requestNumber": "string",
      "retailerId": long,
      "supplierId": long,
      "status": "DRAFT" | "ACCEPTED" | "CANCELLED",
      "validUntil": "2024-01-31T23:59:59",
      "createdAt": "2024-01-01T10:00:00"
    }
  ],
  "page": {
    "size": 20,
    "number": 0,
    "totalElements": 30,
    "totalPages": 2
  }
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Build query with all provided filters</li>
            <li>Apply pagination and sorting</li>
            <li>Return <span class="status-code">200 OK</span> with paginated results</li>
        </ol>
    </div>
</div>

<!-- GET QUOTATION REQUEST BY ID -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-get">GET</span>
        <span class="path">/api/v1/quotations/requests/{requestId}</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Get quotation request details by ID
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
  "requestId": long,
  "requestNumber": "string",
  "retailerId": long,
  "supplierId": long,
  "status": "DRAFT" | "ACCEPTED" | "CANCELLED",
  "items": [
    {
      "productId": long,
      "variantId": long,
      "quantity": integer,
      "specifications": "string"
    }
  ],
  "validUntil": "2024-01-31T23:59:59",
  "notes": "string",
  "createdAt": "2024-01-01T10:00:00"
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Query QuotationRequest by ID</li>
            <li>If not found → <span class="status-code">404 NOT FOUND</span></li>
            <li>Fetch associated QuotationRequestItems</li>
            <li>Return <span class="status-code">200 OK</span></li>
        </ol>
    </div>
</div>

<!-- PATCH QUOTATION REQUEST -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-patch">PATCH</span>
        <span class="path">/api/v1/quotations/requests/{requestId}</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Update quotation request status
    </div>

    <div class="section">
        <div class="section-title">Request Body</div>
        <pre>{
  "status": "ACCEPTED" | "CANCELLED"
}</pre>
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
  "requestId": long,
  "status": "ACCEPTED" | "CANCELLED",
  "updatedAt": "2024-01-01T10:00:00"
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Query QuotationRequest by ID → <span class="status-code">404 NOT FOUND</span></li>
            <li>Validate status is valid → <span class="status-code">400 BAD REQUEST</span></li>
            <li>Check if request is expired → <span class="status-code">400 BAD REQUEST</span></li>
            <li>Update status</li>
            <li>Return <span class="status-code">200 OK</span></li>
        </ol>
    </div>
</div>

<!-- CREATE QUOTATION OFFER -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-post">POST</span>
        <span class="path">/api/v1/quotations/offers</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Submit a quotation offer from supplier in response to request
    </div>

    <div class="section">
        <div class="section-title">Request Body</div>
        <pre>{
  "quotationRequestId": long,         <span class="required">*required</span>
  "supplierId": long,                 <span class="required">*required</span>
  "items": [                          <span class="required">*required, min 1</span>
    {
      "productId": long,              <span class="required">*required</span>
      "variantId": long,              <span class="optional">optional</span>
      "quantity": integer,            <span class="required">*required</span>
      "quotedPrice": number,          <span class="required">*required, positive</span>
      "specifications": "string",     <span class="optional">optional</span>
      "notes": "string"               <span class="optional">optional</span>
    }
  ],
  "validUntil": "2024-01-31T23:59:59", <span class="required">*required, future date</span>
  "notes": "string",                  <span class="optional">optional</span>
  "termsAndConditions": "string"      <span class="optional">optional</span>
}</pre>
    </div>

    <div class="section">
        <div class="section-title">Response Body (201 Created)</div>
        <pre>{
  "offerId": long,
  "status": "SUBMITTED",
  "message": "Quotation offer submitted successfully"
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Validate quotationRequestId exists → <span class="status-code">404 NOT FOUND</span></li>
            <li>Check quotation request is not expired → <span class="status-code">400 BAD REQUEST</span></li>
            <li>Validate supplier is the target supplier → <span class="status-code">403 FORBIDDEN</span></li>
            <li>Validate items not empty → <span class="status-code">400 BAD REQUEST</span></li>
            <li>Check all offer items match request items (including productId and variantId) → <span class="status-code">400 BAD REQUEST</span> if mismatch</li>
            <li>For each item:
                <ul>
                    <li>If variantId provided, validate variantId exists and belongs to productId → <span class="status-code">404 NOT FOUND</span> or <span class="status-code">400 BAD REQUEST</span></li>
                    <li>Validate quotedPrice > 0 → <span class="status-code">400 BAD REQUEST</span></li>
                </ul>
            </li>
            <li>Validate validUntil is future date → <span class="status-code">400 BAD REQUEST</span></li>
            <li>Calculate total amount</li>
            <li>Generate unique offer number</li>
            <li>Create QuotationOffer record with status = SUBMITTED</li>
            <li>Create QuotationOfferItem records</li>
            <li>Return <span class="status-code">201 CREATED</span></li>
        </ol>
    </div>
</div>

<!-- LIST QUOTATION OFFERS -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-get">GET</span>
        <span class="path">/api/v1/quotations/offers</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        List quotation offers with pagination
    </div>

    <div class="section">
        <div class="section-title">Query Parameters</div>
        <table class="field-table">
            <tr>
                <td><code>requestId</code></td>
                <td>long</td>
                <td>Filter by quotation request ID</td>
            </tr>
            <tr>
                <td><code>supplierId</code></td>
                <td>long</td>
                <td>Filter by supplier ID</td>
            </tr>
            <tr>
                <td><code>status</code></td>
                <td>string</td>
                <td>Filter by status (SUBMITTED, ACCEPTED, REJECTED, WITHDRAWN)</td>
            </tr>
            <tr>
                <td><code>page, size, sort</code></td>
                <td></td>
                <td>Standard pagination parameters</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
  "content": [
    {
      "offerId": long,
      "offerNumber": "string",
      "quotationRequestId": long,
      "supplierId": long,
      "totalAmount": number,
      "status": "SUBMITTED" | "ACCEPTED" | "REJECTED" | "WITHDRAWN",
      "validUntil": "2024-01-31T23:59:59",
      "createdAt": "2024-01-01T10:00:00"
    }
  ],
  "page": {
    "size": 20,
    "number": 0,
    "totalElements": 15,
    "totalPages": 1
  }
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Build query with all provided filters</li>
            <li>Apply pagination and sorting</li>
            <li>Return <span class="status-code">200 OK</span> with paginated results</li>
        </ol>
    </div>
</div>

<!-- GET QUOTATION OFFER BY ID -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-get">GET</span>
        <span class="path">/api/v1/quotations/offers/{offerId}</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Get quotation offer details by ID
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
  "offerId": long,
  "offerNumber": "string",
  "quotationRequestId": long,
  "supplierId": long,
  "status": "SUBMITTED" | "ACCEPTED" | "REJECTED" | "WITHDRAWN",
  "items": [
    {
      "productId": long,
      "variantId": long,
      "quantity": integer,
      "quotedPrice": number,
      "specifications": "string",
      "notes": "string"
    }
  ],
  "totalAmount": number,
  "validUntil": "2024-01-31T23:59:59",
  "notes": "string",
  "termsAndConditions": "string",
  "createdAt": "2024-01-01T10:00:00"
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Query QuotationOffer by ID</li>
            <li>If not found → <span class="status-code">404 NOT FOUND</span></li>
            <li>Fetch associated QuotationOfferItems</li>
            <li>Return <span class="status-code">200 OK</span></li>
        </ol>
    </div>
</div>

<!-- PATCH QUOTATION OFFER -->
<div class="endpoint-container">
    <div class="endpoint-header">
        <span class="method method-patch">PATCH</span>
        <span class="path">/api/v1/quotations/offers/{offerId}</span>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        Update quotation offer status
    </div>

    <div class="section">
        <div class="section-title">Request Body</div>
        <pre>{
  "status": "ACCEPTED" | "REJECTED" | "WITHDRAWN"
}</pre>
    </div>

    <div class="section">
        <div class="section-title">Response Body (200 OK)</div>
        <pre>{
  "offerId": long,
  "status": "ACCEPTED" | "REJECTED" | "WITHDRAWN",
  "updatedAt": "2024-01-01T10:00:00"
}</pre>
    </div>

    <div class="behavior-steps">
        <div class="section-title">Behavior</div>
        <ol>
            <li>Query QuotationOffer by ID → <span class="status-code">404 NOT FOUND</span></li>
            <li>Validate status is valid → <span class="status-code">400 BAD REQUEST</span></li>
            <li>Check offer is not expired → <span class="status-code">400 BAD REQUEST</span></li>
            <li>Check offer status is SUBMITTED → <span class="status-code">400 BAD REQUEST</span> if not</li>
            <li>If status == ACCEPTED:
                <ul>
                    <li>Validate retailer owns the original request → <span class="status-code">403 FORBIDDEN</span></li>
                    <li>Optionally auto-create order from quotation</li>
                </ul>
            </li>
            <li>Update status and record decision timestamp</li>
            <li>Return <span class="status-code">200 OK</span></li>
        </ol>
    </div>
</div>

<!-- ========================================
     APPENDIX: PAGINATION STANDARD
     ======================================== -->
<h2>Appendix: Pagination Standard</h2>

<div class="note">
    <h3>Standard Query Parameters</h3>
    <p>All list endpoints support these pagination parameters:</p>
    <table class="field-table">
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Default</th>
            <th>Description</th>
        </tr>
        <tr>
            <td><code>page</code></td>
            <td>integer</td>
            <td>0</td>
            <td>Zero-based page number</td>
        </tr>
        <tr>
            <td><code>size</code></td>
            <td>integer</td>
            <td>20</td>
            <td>Number of items per page (max: 100)</td>
        </tr>
        <tr>
            <td><code>sort</code></td>
            <td>string</td>
            <td>varies</td>
            <td>Sort criteria: property,direction (e.g., name,asc or createdAt,desc)</td>
        </tr>
    </table>

    <h3>Standard Response Format</h3>
    <pre>{
  "content": [...],           // Array of items
  "page": {
    "size": 20,              // Items per page
    "number": 0,             // Current page number (zero-based)
    "totalElements": 150,    // Total items across all pages
    "totalPages": 8          // Total number of pages
  }
}</pre>

    <h3>Endpoints with Pagination</h3>
    <ol>
        <li>GET /api/v1/products</li>
        <li>GET /api/v1/suppliers</li>
        <li>GET /api/v1/retailers</li>
        <li>GET /api/v1/orders</li>
        <li>GET /api/v1/suppliers/{supplierId}/inventory</li>
        <li>GET /api/v1/quotations/requests</li>
        <li>GET /api/v1/quotations/offers</li>
    </ol>
</div>

</body>
</html>
